%!TEX root = ../template.tex
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% chapter2.tex
%% NOVA thesis document file
%%
%% Chapter with the template manual
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Related Work}
\label{cha:related_work}
Since the users are a fundamental component on the study, their relationship with data and what are their expectations to these query systems will be discussed. Moreover, a set of technologies and techniques will be described and compared. This information can turn to be useful to explore solutions, and understand different points of view to manage problems, regarding the project scope. As the project is focused on the improvement of an interface that combines the query design with the query output viewer. 

\section{Users in Database Query Formulation}
\label{sec:users_database_query_formulation}

\section{Low-code Development Users}
\label{sec:low_code_development_users}

\section{Visual Query Composition}
\label{sec:visual_query_composition}

The first relevant topic to analyse is the visual representation approaches, which can be applied to design an user interface capable to build queries through a visual language. Catarci \textit{et al.} \cite{visualQuerySystemsForDatabases_aSurvey} presented an interesting classification according to the visual formalism which the interface is based on:

\begin{itemize}
    \item \textbf{Form-based}: based on forms, which can be seen as a rectangular grid of other components (subforms, groups of cells, a combination of cells, etc.) that group objects in a named collection regarding its structure. Forms and tables are similar,  but contrary to the tables, forms allow nesting. Thus, forms can be seen as a generalization of tables. In this approach, the relationships can be represented among cells, cells subsets, or even the overall set, providing to the user three information levels;
    \item \textbf{Diagram-based}: usage of graphical representations, such as graphs, charts and diagrams to better transmit the relationships among data. The aim is to use visual representations to help the understanding of the relationships between concepts which are represented by textual labels;
    \item \textbf{Icon-based}: as the opposite of the diagram-based, this type of interfaces tries to facilitate the understanding of the concepts instead of relationships. So, are used Icons, which are visual segmented objects to transmit a message or information, using analogies and metaphors with the real-world objects, or even conventions that are used to express no tangible objects, as computer processes;
    \item \textbf{Hybrid}: these approaches can combine the previous visual formalisms in order to select the best combination of advantages to the application usage domain.
\end{itemize}

In order to compare different interfaces, it is essential to analyse what a query language has to support to build the query. Accordingly, Table \ref{tab:query_language_requisites} presents the query creation required specifications, comparing them with the respective indication in SQL.

\begin{table}[ht]
	\caption{Query Language Requisites}
	\label{tab:query_language_requisites}
\centering
\begin{tabular}{|
    >{\columncolor[HTML]{EFEFEF}}l |l|l|}
    \hline
    \cellcolor[HTML]{C0C0C0}{\color[HTML]{333333} \textbf{Specification}} & \cellcolor[HTML]{C0C0C0}{\color[HTML]{333333} \textbf{Description}}                                                                                               & \cellcolor[HTML]{C0C0C0}{\color[HTML]{333333} \textbf{SQL Indication}}                                                                   \\ \hline
    \textbf{Data Source}                                                  & \begin{tabular}[c]{@{}l@{}}Entities and attributes which \\ will be presented in the query\end{tabular}                                                           & \begin{tabular}[c]{@{}l@{}}Using SELECT and \\ FROM statements\end{tabular}                                                              \\ \hline
    \textbf{Merge Type}                                                   & \begin{tabular}[c]{@{}l@{}}Define how will be merged \\ attributes of different entities\end{tabular}                                                             & Using JOIN clauses                                                                                                                       \\ \hline
    \textbf{Filtering Criteria}                                           & \begin{tabular}[c]{@{}l@{}}Criteria that can be used to \\ filter records, presenting in the \\ result only those that fulfil a \\ set of conditions\end{tabular} & \begin{tabular}[c]{@{}l@{}}Using WHERE \\ clause\end{tabular}                                                                            \\ \hline
    \textbf{Sorting Criteria}                                             & \begin{tabular}[c]{@{}l@{}}Define what are the criteria to \\ sort the records of the result\end{tabular}                                                         & \begin{tabular}[c]{@{}l@{}}Using ORDER BY or \\ HAVING clauses\end{tabular}                                                                         \\ \hline
    \textbf{Aggregation Functons}                                         & \begin{tabular}[c]{@{}l@{}}Group a set of records by \\ comparison or using mathematical \\ functions\end{tabular}                                                & \begin{tabular}[c]{@{}l@{}}Using  GROUP BY \\ statements or SQL \\ functions, such as \\ MIN, MAX, \\ COUNT, AVG and \\ SUM\end{tabular} \\ \hline
    \textbf{Calculated Attributes}                                        & \begin{tabular}[c]{@{}l@{}}Attributes added, based on \\ existing ones\end{tabular}                                                                               & \begin{tabular}[c]{@{}l@{}}Using SELECT \\ statement\end{tabular}                                                                        \\ \hline
    \textbf{Distinct Values}                                              & \begin{tabular}[c]{@{}l@{}}If only different values will be \\ considered in the result \\ (removing duplicated values)\end{tabular}                              & \begin{tabular}[c]{@{}l@{}}Using SELECT \\ DISTINCT statement\end{tabular}                                                               \\ \hline
    \textbf{Unions}                                                       & \begin{tabular}[c]{@{}l@{}}Combine the result of two \\ different queries\end{tabular}                                                                            & \begin{tabular}[c]{@{}l@{}}Using UNION \\ operator\end{tabular}                                                                          \\ \hline
    \textbf{Subqueries}                                                   & \begin{tabular}[c]{@{}l@{}}Defining a query that uses \\ other queries, for example, \\ to filter the result\end{tabular}                                         & \begin{tabular}[c]{@{}l@{}}Nesting SELECT \\ statements\end{tabular}                                                                     \\ \hline
    \end{tabular}
\end{table}

Nevertheless, there are two relevant aspects, according to the last requisites presented: the interaction process to indicate the query specifications, the overview of what data wants to be retrieved using the current query. Both are fundamental since a good visual query language aims to simplify not only, the query formulation process but also, the query readability, promoting an efficient and effective recognition of what are the desired data.

\bigskip

\textbf{Data Source:}

Chartio \cite{chartio} has two components to query databases visually: using the Data Explorer \cite{chartioDataExplorer} or using the new Visual SQL \cite{chartioVisualSQL}. Regarding the data source specification, these two systems use different strategies to select and present the entities and attributes related to the query. In the Data Explorer, the user can expand the items of a list of tables in a scrollable and searchable tree view, which is pinned in one side of the window, to choose the desired attributes. This system divides the attributes into two different types: Measures and Dimensions. Usually, measure refers to quantitative data and dimensions to categorical data. So, to insert the attributes in the query, users can drag and drop the required attributes to the form-based interface that contains the Measures, Dimensions and Filters of the query (Figure \ref{fig:chartioDataExplorer}) \cite{chartioDataExplorer}. 

On the other hand, the new component of Chartio, the Visual SQL provides a different interface to select the data sources. Contrary to the previous approach, in this interface, there is none fixed list to choose the attributes. In this way, there is only a search text component that is activated when the user clicks on “add column” action. When this action occurs, is presented a pop-up style component that has a list, similar to the referred above, where is possible to preview some data entries of the table (Figure \ref{fig:chartioVisualSQL}) \cite{chartioVisualSQL}. 

In the systems referred above the columns are added one by one sequentially, but other systems have different methods to select the table’s columns. For example, in Tableau Prep \cite{tableauPrep} there is checkbox list to chose the intended attributes (Figure \ref{fig:tableauPrep}), and in Microsoft Power BI \cite{powerBI} the table is chosen using a list, and all its attributes are added automatically. Also, users can remove, the columns not desired after. \cite{tableauPrepHelpWhatsNew} \cite{powerBIShapeAndCombineData}

Other systems, as Devart dbForge Query Builder \cite{dbForgeQueryBuilder} uses a diagram-based interface to select the entities and attributes of the query. In this system, the user can drag and drop the desired tables to the diagram area, and select through checkboxes the intended attributes, that are presented in the database schema diagram (Figure \ref{fig:devartDbForge}).


\begin{figure}[htbp]
    \centering
    \subcaptionbox{Chartio Data Explorer\label{fig:chartioDataExplorer} \cite{chartioDataExplorer}}%
      {\includegraphics[width=0.5\linewidth]{chartio-data-explorer-data-source}}%
    \subcaptionbox{Chartio Visual SQL\label{fig:chartioVisualSQL} \cite{chartioVisualSQL}}%
      {\includegraphics[width=0.5\linewidth]{chartio-visual-sql-data-source}}%
      \\
    \subcaptionbox{Tableau Prep\label{fig:tableauPrep} \cite{tableauPrepHelpWhatsNew}}%
    {\includegraphics[width=0.5\linewidth]{tableau-data-source}}%
  \subcaptionbox{Devart dbForge Query Builder\label{fig:devartDbForge} \cite{dbForgeQueryBuilder}}%
    {\includegraphics[width=0.5\linewidth]{dbforge-data-source}}%
  \caption{Different approaches to select the entities of the query.}
    \label{fig:approaches_select_data_sources}
  \end{figure}

  \bigskip

\textbf{Merge Type:}



Merges are used when it is necessary to extract data from different tables, so it is necessary to establish what is the join kind to merge the data. Therefore, the interface needs to adopt an interaction and representation technique to specify it. To define a join in Devart dbForge Query Builder \cite{dbForgeQueryBuilder}, the user can only select the attributes’ checkboxes of the different tables and the system generates an inner join automatically. In this system, there are buttons on the toolbar to select all rows of one table, of another, or both, allowing to perform left, right and outer joins respectively \cite{dbForgeMakingJoinsBetweenTables}.
  
Another approach used by some systems, such as Chartio Data Explorer \cite{chartioDataExplorer} and Microsoft Power BI \cite{powerBI}, is a form-based interface to insert a join. In the former, two queries can be merged clicking on a button to popup a form which can be used to select the merge type and the first columns that will be merged using dropdowns \cite{chartioDataExplorer} (Figure \ref{fig:chartioDataExplorerJoin}). Also, if there are null values on the merge related columns, there is an option to include or not the null values match rows \cite{chartioJoiningDataAcrossDatabases}. Similarly, the latter provides a button to merge queries that opens a modal where can be chosen the attributes that will be used on the merge (viewing also a table preview) and the join kind, using a dropdown \cite{powerBIShapeAndCombineData} (Figure \ref{fig:powerBIJoin}).
  
Tableau Prep \cite{tableauPrep} provides two options to start a join between two tables: clicking on a "add join" hover button above the table visual representation with suggestion of related tables, or merge the visual representation of two tables using a drag and drop action. After this selection, the inner join type is selected automatically by the system according to the tables relationship. \cite{tableauAggregateJoinOrUnionData} \cite{tableauAddMoreDataInTheInputStep} However, the user can configure the join in a dedicated section (Figure \ref{fig:tableauJoinPanel}) where it is possible to define the join type using a Venn Diagram, to manage the join clauses using dropdown lists to select the fields, including also some join clause recommendations based on the database schema. Moreover, a summary of the join result that contains counters with the values included and excluded by each table, in a visual way using diagrams is provided. Finally, there is presented a list of the values included and excluded, where the red values represent the values excluded, as well as a preview of the join result \cite{tableauAggregateJoinOrUnionData}.

\begin{figure}[htbp]
    \centering
    \subcaptionbox{Chartio Data Explorer\label{fig:chartioDataExplorerJoin} \cite{chartioDataExplorer}}%
      {\includegraphics[width=0.4\linewidth]{chartio-data-explorer-join}}%
    \subcaptionbox{Microsoft Power BI\label{fig:powerBIJoin} \cite{powerBIShapeAndCombineData}}%
    {\includegraphics[width=0.4\linewidth]{power-bi-join}}%
    \\
    \subcaptionbox{Tableau Prep\label{fig:tableauJoinPanel} \cite{tableauAggregateJoinOrUnionData}}%
      {\includegraphics[width=0.8\linewidth]{tableau-join-panel}}%
  \caption{Data merging approaches.}
    \label{fig:approaches_select_data_sources}
\end{figure}

\bigskip

\textbf{Filtering Criteria}: 

To represent and manage the filtering criteria of the queries, usually is used text to indicate the logical conditions. However, some systems are trying to optimize the usability, helping the user in the specification process through some autocompletes. These diminish the necessity to remember all the syntax and the name of the functions. 
Besides, other systems present the logical conditions using a more structured layout, although keeping resorting in a textual representation. An example is Devart dbForge Query Builder \cite{dbForgeQueryBuilder} that represents the WHERE and HAVING clauses in a tree where the user can organize the conditions into groups \cite{dbForgeBuildingWhereOrHavingClause}.

Furthermore, some query systems also allow the user to view the query result, providing a shortcut in the column's name to insert filters. So, the user can change the query while is viewing the results. In this way, the user can apply a filter and view its effect almost immediately. Power BI Query Editor \cite{powerBI} is an example of a system which uses this approach.

Different interfaces can be used to select filters regarding the field data type. The advantages of the graphical interfaces could support the filtering criteria definition. For example, if a filter is applied to constraint dates, then a date input box with a visual calendar can be useful to simplify the date typing. In this way, some softwares, such as Chartio Visual SQL \cite{chartioVisualSQL} and Chartio Data Explorer \cite{chartioDataExplorer}, not only helps in the data typing, but also provide dropdown lists that contain operators that can be applied to the referred data type (e.g. less than, contains, like, etc)  to helps the user in the boolean operator specification \cite{chartioDataExplorer}  \cite{visualSqlActions}.

Tableau Prep \cite{tableauPrep} follows this in a more strict way, distinguishing between data types when filtering criteria are indicated. It provides different forms depending on the data type. The main difference of this system is that not only provides a more diversity of controls, as integrating range selectors, radio button, and the option to include or exclude fields through an action accessible near its value, but also gives to the user to option to use a calculation form where the interaction style is more textually and more extensible \cite{tableauFilterYourData}.

%\bigskip

%\textbf{Sorting Criteria}: 


\section{Discussion}
\label{sec:discussion}